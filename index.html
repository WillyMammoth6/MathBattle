<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Math Dragon Battle</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #121212;
            font-family: Arial, sans-serif;
            overflow: hidden;
            color: #fff;
        }
        #gameCanvas {
            width: 100%;
            max-width: 600px;
            height: 50vh;
            background-color: #001f3f; /* Dark night sky */
            touch-action: none;
        }
        #question {
            font-size: 24px;
            margin: 10px 0;
            text-align: center;
        }
        #inputDisplay {
            font-size: 28px;
            margin: 10px 0;
            padding: 10px;
            border: 2px solid #fff;
            width: 200px;
            text-align: center;
            background-color: #222;
            color: #fff;
        }
        #numpad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            max-width: 300px;
            width: 100%;
        }
        .numButton {
            font-size: 24px;
            padding: 20px;
            background-color: #333;
            border: 1px solid #555;
            text-align: center;
            cursor: pointer;
            user-select: none;
            touch-action: manipulation;
            color: #fff;
        }
        #message {
            font-size: 32px;
            margin-top: 20px;
            text-align: center;
            color: red;
            display: none;
        }
        #restartButton {
            font-size: 24px;
            padding: 10px 20px;
            background-color: #444;
            color: #fff;
            border: 1px solid #666;
            cursor: pointer;
            margin-top: 10px;
            display: none;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="question"></div>
    <div id="inputDisplay"> </div>
    <div id="numpad">
        <div class="numButton" onclick="appendNumber('1')">1</div>
        <div class="numButton" onclick="appendNumber('2')">2</div>
        <div class="numButton" onclick="appendNumber('3')">3</div>
        <div class="numButton" onclick="appendNumber('4')">4</div>
        <div class="numButton" onclick="appendNumber('5')">5</div>
        <div class="numButton" onclick="appendNumber('6')">6</div>
        <div class="numButton" onclick="appendNumber('7')">7</div>
        <div class="numButton" onclick="appendNumber('8')">8</div>
        <div class="numButton" onclick="appendNumber('9')">9</div>
        <div class="numButton" id="delete" onclick="deleteLast()">Delete</div>
        <div class="numButton" onclick="appendNumber('0')">0</div>
        <div class="numButton" id="enter" onclick="submitAnswer()">Enter</div>
    </div>
    <div id="message"></div>
    <button id="restartButton" onclick="restartGame()">Restart Game</button>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const questionDiv = document.getElementById('question');
        const inputDisplay = document.getElementById('inputDisplay');
        const messageDiv = document.getElementById('message');
        const numpad = document.getElementById('numpad');
        const restartButton = document.getElementById('restartButton');

        // Set canvas size dynamically
        function resizeCanvas() {
            canvas.width = canvas.clientWidth;
            canvas.height = canvas.clientHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // Game state
        let avatarHealth = 3;
        let dragonHealth = 3;
        let currentInput = '';
        let currentQuestion = {};
        let gameOver = false;
        let animationFrame = 0;
        let animating = false;
        let animationType = ''; // 'avatarAttack' or 'dragonAttack'

        // Heart drawing functions
        function drawHeart(x, y, full) {
            ctx.beginPath();
            ctx.moveTo(x, y + 5);
            ctx.bezierCurveTo(x - 5, y, x - 10, y + 10, x, y + 15);
            ctx.bezierCurveTo(x + 10, y + 10, x + 5, y, x, y + 5);
            ctx.fillStyle = full ? 'red' : '#555';
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.stroke();
        }

        function drawHalfHeart(x, y) {
            ctx.beginPath();
            ctx.moveTo(x, y + 5);
            ctx.bezierCurveTo(x - 5, y, x - 10, y + 10, x, y + 15);
            ctx.lineTo(x, y + 5);
            ctx.fillStyle = 'red';
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.stroke();
        }

        // Draw avatar (stick figure knight)
        function drawAvatar(x, y) {
            ctx.strokeStyle = '#fff';
            // Body
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(x, y + 40);
            ctx.stroke();

            // Head
            ctx.beginPath();
            ctx.arc(x, y - 10, 10, 0, Math.PI * 2);
            ctx.stroke();

            // Helmet
            ctx.beginPath();
            ctx.moveTo(x - 10, y - 20);
            ctx.lineTo(x + 10, y - 20);
            ctx.lineTo(x, y - 30);
            ctx.closePath();
            ctx.stroke();

            // Arms
            ctx.beginPath();
            ctx.moveTo(x, y + 10);
            ctx.lineTo(x - 15, y + 20);
            ctx.moveTo(x, y + 10);
            ctx.lineTo(x + 15, y + 20);
            ctx.stroke();

            // Legs
            ctx.beginPath();
            ctx.moveTo(x, y + 40);
            ctx.lineTo(x - 10, y + 60);
            ctx.moveTo(x, y + 40);
            ctx.lineTo(x + 10, y + 60);
            ctx.stroke();

            // Sword
            ctx.beginPath();
            ctx.moveTo(x + 15, y + 20);
            ctx.lineTo(x + 25, y + 10);
            ctx.lineTo(x + 35, y + 20);
            ctx.stroke();
        }

        // Draw dragon
        function drawDragon(x, y) {
            ctx.strokeStyle = '#fff';
            // Body
            ctx.beginPath();
            ctx.ellipse(x, y + 20, 40, 20, 0, 0, Math.PI * 2);
            ctx.stroke();

            // Head
            ctx.beginPath();
            ctx.ellipse(x - 50, y, 20, 15, 0, 0, Math.PI * 2);
            ctx.stroke();

            // Eyes
            ctx.beginPath();
            ctx.arc(x - 55, y - 5, 2, 0, Math.PI * 2);
            ctx.arc(x - 45, y - 5, 2, 0, Math.PI * 2);
            ctx.fillStyle = 'red';
            ctx.fill();

            // Mouth
            ctx.beginPath();
            ctx.moveTo(x - 60, y + 5);
            ctx.lineTo(x - 40, y + 5);
            ctx.stroke();

            // Wings
            ctx.beginPath();
            ctx.moveTo(x - 20, y + 10);
            ctx.lineTo(x - 30, y - 20);
            ctx.lineTo(x - 10, y - 10);
            ctx.moveTo(x + 20, y + 10);
            ctx.lineTo(x + 30, y - 20);
            ctx.lineTo(x + 10, y - 10);
            ctx.stroke();

            // Tail
            ctx.beginPath();
            ctx.moveTo(x + 40, y + 20);
            ctx.lineTo(x + 60, y + 30);
            ctx.lineTo(x + 70, y + 20);
            ctx.stroke();

            // Legs
            ctx.beginPath();
            ctx.moveTo(x - 20, y + 40);
            ctx.lineTo(x - 25, y + 50);
            ctx.moveTo(x + 20, y + 40);
            ctx.lineTo(x + 25, y + 50);
            ctx.stroke();
        }

        // Draw castle in background
        function drawCastle(x, y) {
            ctx.fillStyle = '#333'; // Dark gray for castle
            ctx.strokeStyle = '#fff';

            // Main wall
            ctx.fillRect(x, y, 100, 80);
            ctx.strokeRect(x, y, 100, 80);

            // Left tower
            ctx.fillRect(x - 20, y - 20, 40, 100);
            ctx.strokeRect(x - 20, y - 20, 40, 100);

            // Right tower
            ctx.fillRect(x + 80, y - 20, 40, 100);
            ctx.strokeRect(x + 80, y - 20, 40, 100);

            // Tower tops (triangles)
            ctx.beginPath();
            ctx.moveTo(x - 20, y - 20);
            ctx.lineTo(x, y - 40);
            ctx.lineTo(x + 20, y - 20);
            ctx.fill();
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(x + 80, y - 20);
            ctx.lineTo(x + 100, y - 40);
            ctx.lineTo(x + 120, y - 20);
            ctx.fill();
            ctx.stroke();
        }

        // Draw fire breath animation
        function drawFire(x, y, frame) {
            ctx.fillStyle = 'orange';
            ctx.beginPath();
            ctx.moveTo(x, y);
            for (let i = 0; i < 5; i++) {
                const offset = Math.sin(frame / 5 + i) * 5;
                ctx.lineTo(x - 20 - i * 10, y + offset);
            }
            ctx.fill();
        }

        // Draw sword swing animation
        function drawSwordSwing(x, y, frame) {
            ctx.save();
            ctx.translate(x + 15, y + 20);
            ctx.rotate((frame / 20) * Math.PI);
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(10, -10);
            ctx.lineTo(20, 0);
            ctx.strokeStyle = '#fff';
            ctx.stroke();
            ctx.restore();
        }

        // Render health hearts
        function renderHealth() {
            // Avatar hearts
            for (let i = 0; i < 3; i++) {
                const heartX = 50 + i * 30;
                const heartY = 20;
                if (avatarHealth >= i + 1) {
                    drawHeart(heartX, heartY, true);
                } else if (avatarHealth >= i + 0.5) {
                    drawHalfHeart(heartX, heartY);
                } else {
                    drawHeart(heartX, heartY, false);
                }
            }

            // Dragon hearts
            for (let i = 0; i < 3; i++) {
                const heartX = canvas.width - 50 - i * 30;
                const heartY = 20;
                if (dragonHealth >= i + 1) {
                    drawHeart(heartX, heartY, true);
                } else if (dragonHealth >= i + 0.5) {
                    drawHalfHeart(heartX, heartY);
                } else {
                    drawHeart(heartX, heartY, false);
                }
            }
        }

        // Main draw function
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw castle background
            drawCastle(20, canvas.height - 100);

            // Draw avatar
            drawAvatar(100, canvas.height / 2 - 30);

            // Draw dragon
            drawDragon(canvas.width - 100, canvas.height / 2 - 30);

            // Render health
            renderHealth();

            if (animating) {
                if (animationType === 'avatarAttack') {
                    drawSwordSwing(100, canvas.height / 2 - 30, animationFrame);
                } else if (animationType === 'dragonAttack') {
                    drawFire(canvas.width - 150, canvas.height / 2, animationFrame);
                }
                animationFrame++;
                if (animationFrame > 20) {
                    animating = false;
                    animationFrame = 0;
                    if (gameOver) {
                        numpad.style.display = 'none';
                        questionDiv.textContent = '';
                        inputDisplay.textContent = '';
                        restartButton.style.display = 'block';
                    }
                }
            }
        }

        // Animation loop
        function animate() {
            draw();
            requestAnimationFrame(animate);
        }
        animate();

        // Generate random math question
        function generateQuestion() {
            const ops = ['+', '-', '*', '/'];
            const op = ops[Math.floor(Math.random() * ops.length)];
            let a = Math.floor(Math.random() * 12) + 1;
            let b = Math.floor(Math.random() * 12) + 1;
            let answer;
            let opSymbol = op;

            if (op === '+') {
                answer = a + b;
            } else if (op === '-') {
                if (a < b) [a, b] = [b, a];
                answer = a - b;
            } else if (op === '*') {
                answer = a * b;
                opSymbol = 'ร';
            } else if (op === '/') {
                while (a % b !== 0) {
                    b = Math.floor(Math.random() * 12) + 1;
                }
                answer = a / b;
                opSymbol = 'รท';
            }

            questionDiv.textContent = `${a} ${opSymbol} ${b} = ?`;
            return { op, a, b, answer };
        }

        // Start game
        currentQuestion = generateQuestion();

        // Input functions
        function appendNumber(num) {
            if (gameOver) return;
            if (currentInput.length < 3) { // Limit input to 3 digits max
                currentInput += num;
                inputDisplay.textContent = currentInput;
            }
        }

        function deleteLast() {
            if (gameOver) return;
            currentInput = currentInput.slice(0, -1);
            inputDisplay.textContent = currentInput;
        }

        function submitAnswer() {
            if (gameOver || currentInput === '') return;
            const userAnswer = parseInt(currentInput, 10);
            const correct = userAnswer === currentQuestion.answer;

            if (correct) {
                dragonHealth -= 0.5;
                animating = true;
                animationType = 'avatarAttack';
                if (dragonHealth <= 0) {
                    gameOver = true;
                    messageDiv.textContent = 'You Win! The dragon is defeated!';
                    messageDiv.style.color = 'green';
                    messageDiv.style.display = 'block';
                }
            } else {
                avatarHealth -= 0.5;
                animating = true;
                animationType = 'dragonAttack';
                if (avatarHealth <= 0) {
                    gameOver = true;
                    messageDiv.textContent = 'Game Over! The dragon wins.';
                    messageDiv.style.color = 'red';
                    messageDiv.style.display = 'block';
                }
            }

            currentInput = '';
            inputDisplay.textContent = '';
            if (!gameOver) {
                currentQuestion = generateQuestion();
            }
        }

        function restartGame() {
            avatarHealth = 3;
            dragonHealth = 3;
            gameOver = false;
            messageDiv.style.display = 'none';
            restartButton.style.display = 'none';
            numpad.style.display = 'grid';
            currentQuestion = generateQuestion();
            inputDisplay.textContent = '';
            currentInput = '';
        }
    </script>
</body>
</html>
